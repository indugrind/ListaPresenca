<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Presença v2.0</title>
    
    <link rel="icon" type="image/svg+xml" sizes="any" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%233B82F6'/%3E%3Cpath d='M30 35h40M30 50h40M30 65h25' stroke='%23FFF' stroke-width='8' stroke-linecap='round'/%3E%3C/svg%3E">
    <link rel="apple-touch-icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='20' fill='%233B82F6'/%3E%3Cpath d='M30 35h40M30 50h40M30 65h25' stroke='%23FFF' stroke-width='8' stroke-linecap='round'/%3E%3C/svg%3E">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        'status-present': '#16a34a', 'status-absent': '#dc2626', 'status-justified': '#d97706',
                        'status-present-light': '#dcfce7', 'status-absent-light': '#fee2e2', 'status-justified-light': '#fef3c7',
                        'status-present-dark': '#166534', 'status-absent-dark': '#991b1b', 'status-justified-dark': '#92400e',
                    },
                    animation: { shake: 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both' },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' }, '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' }, '40%, 60%': { transform: 'translate3d(4px, 0, 0)' },
                        }
                    }
                }
            }
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #f1f1f1; } .dark ::-webkit-scrollbar-track { background: #182131; }
        ::-webkit-scrollbar-thumb { background: #a0aec0; border-radius: 4px; } .dark ::-webkit-scrollbar-thumb { background: #4a5568; }
        .modal-backdrop { opacity: 0; visibility: hidden; transition: opacity 0.3s ease, visibility 0.3s ease; }
        .modal-backdrop.active { opacity: 1; visibility: visible; }
        .modal-content { transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-backdrop.active .modal-content { transform: scale(1); }
        .toast { opacity: 0; transform: translateY(20px); transition: opacity 0.3s ease, transform 0.3s ease; visibility: hidden; }
        .toast.show { opacity: 1; transform: translateY(0); visibility: visible; }
        [contenteditable]:focus { outline: none; box-shadow: 0 0 0 2px #3b82f6; background-color: #fefcbf40; }
        .dark [contenteditable]:focus { background-color: #4b556380; }
        .editable-field:hover .edit-icon { opacity: 1; } .edit-icon { opacity: 0; transition: opacity 0.2s; }
        .status-btn.active-P { background-color: #16a34a; color: white; }
        .status-btn.active-F { background-color: #dc2626; color: white; }
        .status-btn.active-J { background-color: #d97706; color: white; }
        .sortable-header { cursor: pointer; user-select: none; }
        #diary-table td, #diary-table th { min-width: 40px; text-align: center; }
    </style>
</head>
<body class="bg-gray-200 dark:bg-gray-900 text-gray-800 dark:text-gray-200 transition-colors duration-300">

    <div id="loading-screen" class="fixed inset-0 bg-gray-100 dark:bg-gray-900 flex items-center justify-center p-4 z-50">
        <div class="text-center">
            <svg class="animate-spin h-10 w-10 text-blue-500 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
            <p class="mt-4 text-lg font-semibold text-gray-700 dark:text-gray-200">Carregando dados da nuvem...</p>
        </div>
    </div>

    <main class="container mx-auto p-2 sm:p-4 md:p-8 max-w-5xl hidden">
        <header class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-4 sm:p-6 mb-4 sm:mb-8">
            <div class="flex justify-between items-start">
                <div class="flex items-center gap-2 min-w-0 editable-field">
                    <h1 id="class-title-header" contenteditable="true" title="Clique para editar o nome da turma" class="text-xl sm:text-2xl md:text-3xl font-bold text-gray-700 dark:text-gray-100 p-1 -ml-1 rounded-md truncate cursor-text"></h1>
                    <svg class="edit-icon w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.5L16.732 3.732z"></path></svg>
                </div>
                <div class="flex items-center gap-1 sm:gap-2 flex-shrink-0">
                    <button id="diary-btn" class="p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700" title="Diário de Classe Mensal"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/><path d="m9 16 2 2 4-4"/></svg></button>
                    <button id="charts-btn" class="p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700" title="Gráficos e Estatísticas"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"/><path d="M18.7 8a6 6 0 0 0-6 6"/><path d="M13 13a2 2 0 0 0 2 2"/></svg></button>
                    <button id="reports-btn" class="p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700" title="Relatórios"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><line x1="10" x2="8" y1="9" y2="9"/></svg></button>
                    <button id="theme-toggle" class="p-2 rounded-full text-gray-500 hover:bg-gray-200 dark:hover:bg-gray-700" title="Alternar tema"></button>
                </div>
            </div>
            <div class="mt-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                <div class="flex items-center gap-2">
                    <input type="date" id="attendanceDate" class="py-2 px-3 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-gray-50 dark:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div id="currentTime" class="text-sm font-semibold bg-blue-100 dark:bg-blue-900/50 text-blue-700 dark:text-blue-300 py-2 px-4 rounded-md"></div>
            </div>
        </header>

        <div class="grid md:grid-cols-2 gap-4 sm:gap-8 mb-4 sm:mb-8">
            <section class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-4 sm:p-6">
                <h2 class="text-xl font-semibold mb-4 text-gray-700 dark:text-gray-100">Gerenciar Alunos</h2>
                <div class="flex flex-col gap-4">
                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <input type="text" id="studentName" placeholder="Novo aluno" class="w-full flex-grow py-2 px-3 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:border-gray-600">
                        <button id="addStudentBtn" class="bg-blue-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-blue-600 flex items-center justify-center gap-2 text-sm w-full sm:w-auto flex-shrink-0"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>Adicionar</button>
                    </div>
                    <div class="flex flex-wrap gap-1 sm:gap-2">
                        <button id="pasteListBtn" class="bg-teal-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-teal-600 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2H8a2 2 0 0 0-2 2v2h8V4a2 2 0 0 0-2-2Z"/><path d="M16 4h2a2 2 0 0 1 2 2v4h-4V4Z"/><path d="M18 10h4v8a2 2 0 0 1-2 2h-2"/><path d="M6 10H2v8a2 2 0 0 0 2 2h2"/><rect width="8" height="8" x="8" y="12" rx="1"/></svg>Colar Lista</button>
                        <button id="deleteAllStudentsBtn" class="bg-red-600 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-700 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6"/><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>Apagar Alunos</button>
                    </div>
                </div>
            </section>
            
            <section class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl p-4 sm:p-6">
                <h2 class="text-xl font-semibold mb-4">Ações da Lista</h2>
                <div class="flex flex-wrap gap-1 sm:gap-2">
                    <button id="markAllPresentBtn" class="bg-cyan-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-cyan-600 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6 7 17l-5-5"></path><path d="m22 10-7.5 7.5L13 16"></path></svg>Marcar Todos P</button>
                    <button id="markAbsenteesBtn" class="bg-orange-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-orange-600 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" x2="6" y1="6" y2="18"></line><line x1="6" x2="18" y1="6" y2="18"></line></svg>Marcar Ausentes F</button>
                    <button id="clearAllBtn" class="bg-yellow-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-yellow-600 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.4l9.6-9.6c1-1 2.5-1 3.4 0l5.6 5.6c1 1 1 2.5 0 3.4L13 21H7Z"/><path d="M22 21H7"/><path d="m5 12 5 5"/></svg>Limpar Marcações</button>
                    <button id="exportPdfBtn" class="bg-green-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-green-600 flex items-center gap-2 text-sm"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"></path><polyline points="14 2 14 8 20 8"></polyline><path d="M12 18v-6"></path><path d="m15 15-3 3-3-3"></path></svg>Baixar PDF</button>
                </div>
            </section>
        </div>

        <section id="attendance-table-container" class="bg-white dark:bg-gray-800 shadow-xl rounded-2xl overflow-hidden">
            <div class="p-4 sm:p-6 border-b border-gray-200 dark:border-gray-700">
                <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
                    <div><h2 class="text-xl font-semibold">Lista da Turma</h2><p id="list-date-display" class="text-gray-500 dark:text-gray-400 mt-1 text-sm"></p></div>
                    <div class="relative w-full sm:w-auto"><input type="text" id="searchStudent" placeholder="Buscar aluno..." class="p-2 pl-8 border rounded-md w-full sm:w-auto text-sm dark:bg-gray-700 dark:border-gray-600"><svg class="absolute left-2 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></div>
                </div>
                <div id="attendance-summary" class="mt-4 flex flex-wrap gap-2 sm:gap-4 text-sm"></div>
            </div>
            <div class="overflow-x-auto"><table class="w-full min-w-full text-left">
                <thead class="bg-gray-50 dark:bg-gray-700/50 border-b dark:border-gray-700"><tr>
                    <th class="px-2 py-3 sm:p-4 text-sm font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-300">#</th>
                    <th id="sort-by-name" class="sortable-header px-2 py-3 sm:p-4 text-sm font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-300">Nome <span></span></th>
                    <th id="sort-by-status" class="sortable-header px-2 py-3 sm:p-4 text-sm font-semibold uppercase tracking-wider text-center text-gray-600 dark:text-gray-300">Status <span></span></th>
                    <th class="px-2 py-3 sm:p-4 text-sm font-semibold uppercase tracking-wider text-center text-gray-600 dark:text-gray-300">Ações</th>
                </tr></thead>
                <tbody id="studentList" class="divide-y divide-gray-200 dark:divide-gray-700"></tbody>
            </table>
            <div id="empty-state" class="hidden text-center p-8 text-gray-500"><p>Nenhum aluno cadastrado.</p></div>
            <div id="empty-search-state" class="hidden text-center p-8 text-gray-500"><p>Nenhum resultado encontrado.</p></div>
            </div>
        </section>
    </main>

    <div id="confirmationModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]"><div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-md"><h3 class="text-lg font-bold mb-4" id="modalTitle"></h3><p class="text-gray-600 dark:text-gray-300 mb-6" id="modalMessage"></p><div class="flex justify-end gap-4"><button class="modal-close-btn bg-gray-200 dark:bg-gray-600 py-2 px-4 rounded-md">Cancelar</button><button id="confirmButton" class="bg-red-600 text-white py-2 px-4 rounded-md">Confirmar</button></div></div></div>
    <div id="pasteModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]"><div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-lg"><h3 class="text-lg font-bold mb-4">Colar Lista de Nomes</h3><p class="text-gray-600 dark:text-gray-300 mb-4">Cole a lista de nomes abaixo, um por linha.</p><textarea id="pasteTextarea" class="w-full h-40 p-2 border rounded-md dark:bg-gray-700 dark:border-gray-600" placeholder="João da Silva..."></textarea><div class="flex justify-end gap-4 mt-6"><button class="modal-close-btn bg-gray-200 dark:bg-gray-600 py-2 px-4 rounded-md">Cancelar</button><button id="confirmPasteButton" class="bg-teal-500 text-white py-2 px-4 rounded-md">Adicionar</button></div></div></div>
    <div id="reportsModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]"><div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-4xl"><h3 class="text-lg font-bold mb-4">Relatório de Assiduidade da Turma</h3><div id="reports-content" class="max-h-[70vh] overflow-y-auto"></div><div class="flex justify-end gap-4 mt-6"><button class="modal-close-btn bg-gray-200 dark:bg-gray-600 py-2 px-4 rounded-md">Fechar</button></div></div></div>
    <div id="diaryModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-2 sm:p-4 z-[60]"><div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-4 sm:p-6 w-full max-w-7xl"><div class="flex justify-between items-center mb-4"><h3 class="text-lg font-bold">Diário de Classe Mensal</h3><div class="flex items-center gap-2"><button id="prev-month-btn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">&lt;</button><span id="diary-month-year" class="font-semibold w-32 text-center"></span><button id="next-month-btn" class="p-2 rounded-md hover:bg-gray-200 dark:hover:bg-gray-700">&gt;</button></div></div><div id="diary-content" class="max-h-[70vh] overflow-auto"></div><div class="flex justify-end gap-4 mt-6"><button class="modal-close-btn bg-gray-200 dark:bg-gray-600 py-2 px-4 rounded-md">Fechar</button></div></div></div>
    <div id="chartsModal" class="modal-backdrop fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-[60]"><div class="modal-content bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6 w-full max-w-2xl"><h3 class="text-lg font-bold mb-4">Estatísticas Visuais da Turma</h3><div id="charts-content" class="max-h-[70vh] overflow-y-auto"><div class="w-full mx-auto" style="max-width: 400px;"><canvas id="attendance-chart"></canvas></div></div><div class="flex justify-end gap-4 mt-6"><button class="modal-close-btn bg-gray-200 dark:bg-gray-600 py-2 px-4 rounded-md">Fechar</button></div></div></div>
    <div id="toast" class="toast fixed bottom-5 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-2 px-5 rounded-full shadow-lg z-[70]"></div>
    <div id="undo-toast" class="toast fixed bottom-16 left-1/2 -translate-x-1/2 bg-gray-800 text-white py-2 px-5 rounded-full shadow-lg z-[70] flex items-center gap-4"><span id="undo-message"></span><button id="undo-btn" class="font-bold underline">Desfazer</button></div>

    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script>
        // ***************************************************************
        // ** COLE AQUI A CONFIGURAÇÃO DO SEU FIREBASE **
        // ***************************************************************
        const firebaseConfig = {
            apiKey: "SUA_API_KEY",
            authDomain: "SEU_AUTH_DOMAIN",
            databaseURL: "SEU_DATABASE_URL",
            projectId: "SEU_PROJECT_ID",
            storageBucket: "SEU_STORAGE_BUCKET",
            messagingSenderId: "SEU_MESSAGING_SENDER_ID",
            appId: "SEU_APP_ID"
        };
        // ***************************************************************

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
    </script>

    <script>
    document.addEventListener('DOMContentLoaded', () => {
        const $ = (selector) => document.querySelector(selector);
        
        // ... [Todo o código JS do Diário de Classe Pro será adaptado e inserido aqui]
        
    });
    </script>

</body>
</html>
